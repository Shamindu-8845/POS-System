<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Restaurants POS</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7"
            crossorigin="anonymous"
    >
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
            rel="stylesheet"
    >
    <link
            href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Great+Vibes&display=swap"
            rel="stylesheet"
    >

    <link rel="stylesheet" href="style/style.css">

    <style>
        body {
            background: url('assets/images/Resturate-image.webp') center/cover no-repeat fixed;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
    </style>
</head>
<body>

<header class="bg-light shadow-sm">
    <div class="container-fluid py-2">
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <div class="d-flex align-items-center mb-2 mb-md-0">
                <img src="assets/icon/resturante-image.png" width="40" class="me-2" alt="Logo">
                <h5 class="mb-0">LOGO.</h5>
            </div>
            <nav class="mb-2 mb-md-0">
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('home')">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('customer')">Customer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('item')">Item</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('orders')">Orders</a>
                    </li>
                </ul>
            </nav>
            <div class="mb-2 mb-md-0">
                <button type="button" class="btn btn-warning me-2" onclick="showSection('login')">
                    Login
                </button>
                <button class="btn btn-outline-danger">Logout</button>
            </div>
        </div>
    </div>
</header>

<main class="main-content">
    <!-- Home Section -->
    <div id="home" class="section active">
        <div class="section-container">
            <div class="box text-center">
                <h1>Welcome</h1>
                <h2>Restaurants POS</h2>
                <button class="btn btn-custom mt-4 start-btn" onclick="showSection('login')">Start Here</button>
                <div class="footer-text">¬© All Rights Reserved to Shamindu Kalugalage</div>
            </div>
        </div>
    </div>

    <!-- Login Section -->
    <div id="login" class="section">
        <div class="section-container">
            <div class="box">
                <h1 class="text-center">Login</h1>
                <p class="text-center">Don't have an account? <a href="#" onclick="showSection('signup')">Sign up</a></p>
                <form class="mt-4">
                    <div class="mb-3">
                        <label for="loginUsername" class="form-label">Username</label>
                        <input type="text" id="loginUsername" class="form-control" placeholder="Enter username">
                    </div>
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Password</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Enter password">
                    </div>
                    <button type="submit" class="btn btn-custom w-100 login-btn" onclick="showSection('customer')">Login</button>
                </form>
                <div class="footer-text mt-3">¬© Shamindu Kalugalage</div>
            </div>
        </div>
    </div>

    <!-- Signup Section -->
    <div id="signup" class="section">
        <div class="section-container">
            <div class="box">
                <h1 class="text-center">Sign Up</h1>
                <p class="text-center">Already have an account? <a href="#" onclick="showSection('login')">Login</a></p>
                <form class="mt-4">
                    <div class="mb-3">
                        <label for="firstName" class="form-label">First Name</label>
                        <input type="text" id="firstName" class="form-control" placeholder="First name">
                    </div>
                    <div class="mb-3">
                        <label for="lastName" class="form-label">Last Name</label>
                        <input type="text" id="lastName" class="form-control" placeholder="Last name">
                    </div>
                    <div class="mb-3">
                        <label for="signupUsername" class="form-label">Username</label>
                        <input type="text" id="signupUsername" class="form-control" placeholder="Choose username">
                    </div>
                    <div class="mb-3">
                        <label for="signupPassword" class="form-label">Password</label>
                        <input type="password" id="signupPassword" class="form-control" placeholder="Create password">
                    </div>
                    <button type="submit" class="btn btn-success w-100" onclick="showSection('login')">Register</button>
                </form>
                <div class="footer-text mt-3">¬© Shamindu Kalugalage</div>
            </div>
        </div>
    </div>

    <!-- Customer Section -->
    <div id="customer" class="section">
        <div class="customer-container box">
            <h1>Customer</h1>
            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="highlight-bar">Add new Customer ‚ûï</div>
                    <button class="btn btn-danger" onclick="showSection('home')">Exit</button>
                </div>

                <div class="row">
                    <!-- Left Form -->
                    <div class="col-md-5">
                        <div class="mb-2">
                            <label class="form-label">Customer ID:</label>
                            <input type="text" id="customerId" class="form-control" value="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Name:</label>
                            <input type="text" id="customerName" class="form-control" value="" />
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Telephone No:</label>
                            <input type="text" id="customerPhone" class="form-control" value="" />
                        </div>
                        <div class="mt-3">
                            <button id="addCustomer" class="btn btn-add me-2">Add</button>
                            <button id="updateCustomer" class="btn btn-update me-2">Update</button>
                            <button id="deleteCustomer" class="btn btn-delete">Delete</button>
                        </div>
                    </div>

                    <!-- Right Table + Search -->
                    <div class="col-md-7">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="highlight-bar">Search Customer üîç</div>
                            <button id="viewAllCustomers" class="btn btn-view-all">View All</button>
                        </div>
                        <div class="input-group mb-3">
                            <input type="text" id="customerSearch" class="form-control" placeholder="Customer ID/Name/TelephoneNo" />
                            <select id="searchType" class="form-select" style="max-width: 150px;">
                                <option value="phone">Telephone</option>
                                <option value="id">ID</option>
                                <option value="name">Name</option>
                            </select>
                            <button id="searchCustomer" class="btn btn-primary">Search</button>
                        </div>
                        <table class="table table-bordered text-center">
                            <thead class="table-success">
                            <tr>
                                <th>Customer-ID</th>
                                <th>Name</th>
                                <th>Telephone NO</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody id="customerTableBody">
                            <!-- Data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Item Section -->
    <div id="item" class="section">
        <div class="container mt-4">
            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="text-center mb-0">Item Management</h2>
                    <button class="btn btn-danger" onclick="showSection('home')">
                        <i class="fas fa-times me-1"></i> Exit
                    </button>
                </div>

                <div class="row">
                    <!-- Left Form -->
                    <div class="col-md-5">
                        <div class="mb-3">
                            <label class="form-label">Item ID:</label>
                            <input type="text" class="form-control" id="item_IdInput" placeholder="Enter item ID">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Name:</label>
                            <input type="text" class="form-control" id="item_NameInput" placeholder="Enter item name">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Qty:</label>
                            <input type="number" class="form-control" id="item_QtyInput" placeholder="Enter quantity" min="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Price (LKR):</label>
                            <div class="input-group">
                                <span class="input-group-text">Rs.</span>
                                <input type="number" class="form-control" id="item_PriceInput" placeholder="Enter price" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Expire Date:</label>
                            <input type="date" class="form-control" id="itemExpireDateInput">
                        </div>
                        <div class="mt-3 action-buttons">
                            <button class="btn btn-success me-2" id="add_ItemBtn">
                                <i class="fas fa-plus me-1"></i> Add
                            </button>
                            <button class="btn btn-warning me-2" id="updateItemBtn" disabled>
                                <i class="fas fa-pencil-alt me-1"></i> Update
                            </button>
                            <button class="btn btn-danger" id="deleteItemBtn" disabled>
                                <i class="fas fa-trash me-1"></i> Delete
                            </button>
                            <button class="btn btn-secondary" id="resetFormBtn">
                                <i class="fas fa-undo me-1"></i> Reset
                            </button>
                        </div>
                    </div>

                    <!-- Right Table + Search -->
                    <div class="col-md-7">
                        <div class="card mb-4">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-search me-2"></i>Search Item</h5>
                                <button class="btn btn-info btn-sm" id="viewAllItemsBtn">
                                    <i class="fas fa-list me-1"></i> View All
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="itemSearchInput" placeholder="Search by ID or name">
                                    <button class="btn btn-primary" id="search_ItemBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-bordered table-hover">
                                <thead class="table-success">
                                <tr>
                                    <th>Item ID</th>
                                    <th>Item Name</th>
                                    <th>Qty</th>
                                    <th>Price (LKR)</th>
                                    <th>Expire Date</th>
                                    <th>Status</th>
                                </tr>
                                </thead>
                                <tbody id="itemTableBody">
                                <!-- Items will be populated here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Orders Section -->
    <div id="orders" class="section active">
        <div class="container mt-4">
            <div class="card p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="text-center mb-0">Order Management</h2>
                    <button class="btn btn-danger" id="exitBtn">
                        <i class="fas fa-times me-1"></i> Exit
                    </button>
                </div>

                <div class="row">
                    <!-- Left Form -->
                    <div class="col-md-5">
                        <div class="mb-3">
                            <label class="form-label">Order ID:</label>
                            <input type="text" class="form-control" id="orderIdInput" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Customer:</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="customerIdInput" placeholder="Customer ID">
                                <button class="btn btn-outline-secondary" id="searchCustomerBtn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Customer Name:</label>
                            <input type="text" class="form-control" id="customerNameInput" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Item:</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="itemIdInput" placeholder="Item ID">
                                <button class="btn btn-outline-secondary" id="searchItemBtn">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Item Name:</label>
                            <input type="text" class="form-control" id="itemNameInput" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Unit Price:</label>
                            <input type="number" class="form-control" id="itemPriceInput" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quantity:</label>
                            <input type="number" class="form-control" id="itemQtyInput" value="1" min="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Order Date:</label>
                            <input type="date" class="form-control" id="orderDateInput">
                        </div>
                        <div class="mt-3 action-buttons">
                            <button class="btn btn-success me-2" id="addItemBtn">
                                <i class="fas fa-plus me-1"></i> Add Item
                            </button>
                            <button class="btn btn-secondary" id="clearFormBtn">
                                <i class="fas fa-undo me-1"></i> Clear
                            </button>
                        </div>
                    </div>

                    <!-- Right Payment Section -->
                    <div class="col-md-7">
                        <div class="card mb-4">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Current Order</h5>
                                <span id="orderStatusBadge" class="badge bg-primary">New Order</span>
                            </div>
                            <div class="card-body">
                                <div id="orderItemsContainer">
                                    <p class="text-muted text-center">No items added to order</p>
                                </div>
                                <div class="payment-section mt-3">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Sub Total:</span>
                                        <span id="subTotalAmount">0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Discount:</span>
                                        <div>
                                            <input type="number" class="form-control discount-input" id="discountInput" value="0" min="0">
                                            <span>%</span>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Tax (10%):</span>
                                        <span id="taxAmount">0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-3 fw-bold fs-5">
                                        <span>Total:</span>
                                        <span id="totalAmount">0.00</span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Payment Method:</label>
                                        <select class="form-select" id="paymentMethodSelect">
                                            <option value="Cash">Cash</option>
                                            <option value="Card">Card</option>
                                            <option value="Online">Online Payment</option>
                                        </select>
                                    </div>
                                    <div class="mb-3" id="cashReceivedContainer">
                                        <label class="form-label">Cash Received:</label>
                                        <input type="number" class="form-control" id="cashReceivedInput" value="0.00" min="0" step="0.01">
                                    </div>
                                    <div class="d-flex justify-content-between mb-3 fw-bold">
                                        <span>Change:</span>
                                        <span id="changeAmount">0.00</span>
                                    </div>
                                    <button class="btn btn-primary w-100" id="saveOrderBtn">
                                        <i class="fas fa-save me-1"></i> Save Order
                                    </button>
                                    <button class="btn btn-success w-100 mt-2" id="completeOrderBtn" disabled>
                                        <i class="fas fa-credit-card me-1"></i> Complete Payment
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Order History Section -->
                        <div class="card">
                            <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Order History</h5>
                                <button class="btn btn-info btn-sm" id="viewAllOrdersBtn">
                                    <i class="fas fa-list me-1"></i> View All
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" id="searchOrderInput" placeholder="Search by Order ID or Customer">
                                    <button class="btn btn-primary" id="searchOrderBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead class="table-success">
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Date</th>
                                            <th>Payment</th>
                                            <th>Actions</th>
                                        </tr>
                                        </thead>
                                        <tbody id="orderHistoryTable">
                                        <!-- Orders will be populated here by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Order Details - <span id="modalOrderId"></span></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong>Customer:</strong> <span id="modalCustomerName"></span></p>
                            <p><strong>Date:</strong> <span id="modalOrderDate"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Status:</strong> <span id="modalOrderStatus" class="badge"></span></p>
                            <p><strong>Payment:</strong> <span id="modalPaymentStatus" class="badge"></span></p>
                        </div>
                    </div>

                    <div class="table-responsive mb-3">
                        <table class="table table-bordered">
                            <thead class="table-light">
                            <tr>
                                <th>Item ID</th>
                                <th>Item Name</th>
                                <th>Price</th>
                                <th>Qty</th>
                                <th>Total</th>
                            </tr>
                            </thead>
                            <tbody id="modalOrderItems">
                            <!-- Order items will be populated here -->
                            </tbody>
                            <tfoot>
                            <tr>
                                <th colspan="4" class="text-end">Sub Total:</th>
                                <td id="modalSubTotal"></td>
                            </tr>
                            <tr>
                                <th colspan="4" class="text-end">Discount:</th>
                                <td id="modalDiscount"></td>
                            </tr>
                            <tr>
                                <th colspan="4" class="text-end">Tax (10%):</th>
                                <td id="modalTax"></td>
                            </tr>
                            <tr class="fw-bold">
                                <th colspan="4" class="text-end">Total:</th>
                                <td id="modalTotal"></td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div id="paymentSection">
                        <h5>Payment Information</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Method:</strong> <span id="modalPaymentMethod"></span></p>
                                <p><strong>Cash Received:</strong> <span id="modalCashReceived"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Change:</strong> <span id="modalChange"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="editOrderBtn">
                        <i class="fas fa-edit me-1"></i> Edit Order
                    </button>
                    <button type="button" class="btn btn-success" id="completePaymentBtn">
                        <i class="fas fa-check-circle me-1"></i> Complete Payment
                    </button>
                    <button type="button" class="btn btn-danger" id="deleteOrderBtn">
                        <i class="fas fa-trash me-1"></i> Delete Order
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Success Modal -->
    <div class="modal fade" id="paymentSuccessModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">Payment Successful</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <i class="fas fa-check-circle text-success mb-3" style="font-size: 4rem;"></i>
                    <h4>Payment Completed Successfully!</h4>
                    <p>Order ID: <strong id="completedOrderId"></strong></p>
                    <p>Total Amount: <strong id="completedOrderAmount"></strong></p>
                    <p>Change: <strong id="completedOrderChange"></strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" id="printReceiptBtn">
                        <i class="fas fa-print me-1"></i> Print Receipt
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
        crossorigin="anonymous"
></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // User data array (in a real app, this would be from a database)
        const users = [
            { id: 1, username: 'admin', password: '123', name: 'System Admin', role: 'admin' },
            { id: 2, username: 'cashier', password: '123', name: 'Cashier User', role: 'cashier' },
            { id: 3, username: 'manager', password: '123', name: 'Restaurant Manager', role: 'manager' }
        ];

        // DOM Elements
        const loginForm = document.querySelector('#login form');
        const loginUsername = document.getElementById('loginUsername');
        const loginPassword = document.getElementById('loginPassword');
        const signupLink = document.querySelector('#login a[onclick="showSection(\'signup\')"]');

        // Current user (will be set after successful login)
        let currentUser = null;

        // Login form submission
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            handleLogin();
        });

        // Login button click (if not using form submission)
        const loginBtn = document.querySelector('#login .login-btn');
        if (loginBtn) {
            loginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                handleLogin();
            });
        }

        // Login function
        function handleLogin() {
            const username = loginUsername.value.trim();
            const password = loginPassword.value.trim();

            // Validate inputs
            if (!username || !password) {
                showAlert('Please enter both username and password', 'danger');
                return;
            }

            // Find user in array
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                // Successful login
                currentUser = user;
                showAlert(`Welcome back, ${user.name}!`, 'success');

                // Redirect based on role (you can customize this)
                switch(user.role) {
                    case 'admin':
                        showSection('customer');
                        break;
                    case 'manager':
                        showSection('orders');
                        break;
                    case 'cashier':
                        showSection('orders');
                        break;
                    default:
                        showSection('customer');
                }

                // Update UI to show logged in state
                updateLoginState();
            } else {
                // Failed login
                showAlert('Invalid username or password', 'danger');
                loginPassword.value = '';
            }
        }

        // Show alert message
        function showAlert(message, type) {
            // Remove any existing alerts
            const existingAlert = document.querySelector('#login .alert');
            if (existingAlert) {
                existingAlert.remove();
            }

            // Create alert element
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} mt-3`;
            alertDiv.textContent = message;

            // Insert before the form's submit button
            loginForm.insertBefore(alertDiv, loginForm.lastElementChild);

            // Auto-remove after 3 seconds
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Update UI based on login state
        function updateLoginState() {
            const loginBtn = document.querySelector('header .btn-warning');
            const logoutBtn = document.querySelector('header .btn-outline-danger');

            if (currentUser) {
                // User is logged in
                if (loginBtn) loginBtn.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'block';

                // Update header with user info
                const userInfo = document.createElement('div');
                userInfo.className = 'd-flex align-items-center ms-3';
                userInfo.innerHTML = `
                <span class="me-2">${currentUser.name}</span>
                <span class="badge bg-secondary">${currentUser.role}</span>
            `;

                const headerNav = document.querySelector('header nav');
                if (headerNav) {
                    headerNav.parentNode.insertBefore(userInfo, headerNav.nextSibling);
                }
            } else {
                // User is logged out
                if (loginBtn) loginBtn.style.display = 'block';
                if (logoutBtn) logoutBtn.style.display = 'none';
            }
        }

        // Logout functionality
        const logoutBtn = document.querySelector('header .btn-outline-danger');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                currentUser = null;
                updateLoginState();
                showSection('home');
                showAlert('You have been logged out', 'info');
            });
        }

        // Section switching function (should match your existing function)
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
            }

            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            const navLink = document.querySelector(`.nav-link[onclick="showSection('${sectionId}')"]`);
            if (navLink) {
                navLink.classList.add('active');
            }
        }

        // Initialize login state
        updateLoginState();
    });
</script>

<script>
    function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });

        // Update active nav link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('onclick') && link.getAttribute('onclick').includes(sectionId)) {
                link.classList.add('active');
            }
        });

        // Show the selected section
        const section = document.getElementById(sectionId);
        if (section) {
            section.classList.add('active');
        }

        // Special case for login/signup buttons
        if (sectionId === 'login' || sectionId === 'signup') {
            document.querySelector('.nav-link[onclick*="home"]').classList.add('active');
        }
    }

    // Initialize with home section
    document.addEventListener('DOMContentLoaded', function() {
        showSection('home');
    });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const customerIdInput = document.getElementById('customerId');
        const customerNameInput = document.getElementById('customerName');
        const customerPhoneInput = document.getElementById('customerPhone');
        const addBtn = document.getElementById('addCustomer');
        const updateBtn = document.getElementById('updateCustomer');
        const deleteBtn = document.getElementById('deleteCustomer');
        const searchInput = document.getElementById('customerSearch');
        const searchType = document.getElementById('searchType');
        const searchBtn = document.getElementById('searchCustomer');
        const viewAllBtn = document.getElementById('viewAllCustomers');
        const customerTableBody = document.getElementById('customerTableBody');

        // Customer data array
        let customers = [
            { id: 'C001', name: 'Shamindu', phone: '0751538845' },
            { id: 'C002', name: 'Sasanka', phone: '0751666385' },
            { id: 'C003', name: 'Rani', phone: '0772604586' },
            { id: 'C004', name: 'Kasun', phone: '0741538845' }
        ];

        // Current customer being edited
        let currentCustomerId = null;

        // Render customer table
        function renderCustomers(customersToRender = customers) {
            customerTableBody.innerHTML = '';
            customersToRender.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${customer.id}</td>
                <td>${customer.name}</td>
                <td>${customer.phone}</td>
                <td>
                    <button class="btn btn-sm btn-warning edit-btn" data-id="${customer.id}">Edit</button>
                    <button class="btn btn-sm btn-danger delete-row-btn" data-id="${customer.id}">Delete</button>
                </td>
            `;
                customerTableBody.appendChild(row);
            });

            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    editCustomer(customerId);
                });
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-row-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const customerId = this.getAttribute('data-id');
                    deleteCustomer(customerId);
                });
            });
        }

        // Add new customer
        addBtn.addEventListener('click', function() {
            const newCustomer = {
                id: customerIdInput.value,
                name: customerNameInput.value,
                phone: customerPhoneInput.value
            };

            if (newCustomer.id && newCustomer.name && newCustomer.phone) {
                customers.push(newCustomer);
                renderCustomers();
                clearForm();
            } else {
                alert('Please fill all fields');
            }
        });

        // Update customer
        updateBtn.addEventListener('click', function() {
            if (currentCustomerId) {
                const customerIndex = customers.findIndex(c => c.id === currentCustomerId);
                if (customerIndex !== -1) {
                    customers[customerIndex] = {
                        id: customerIdInput.value,
                        name: customerNameInput.value,
                        phone: customerPhoneInput.value
                    };
                    renderCustomers();
                    clearForm();
                    currentCustomerId = null;
                    updateBtn.disabled = true;
                    deleteBtn.disabled = true;
                }
            }
        });

        // Delete customer
        deleteBtn.addEventListener('click', function() {
            if (currentCustomerId) {
                if (confirm('Are you sure you want to delete this customer?')) {
                    customers = customers.filter(c => c.id !== currentCustomerId);
                    renderCustomers();
                    clearForm();
                    currentCustomerId = null;
                    updateBtn.disabled = true;
                    deleteBtn.disabled = true;
                }
            }
        });

        // Edit customer
        function editCustomer(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                customerIdInput.value = customer.id;
                customerNameInput.value = customer.name;
                customerPhoneInput.value = customer.phone;
                currentCustomerId = customer.id;
                updateBtn.disabled = false;
                deleteBtn.disabled = false;
            }
        }

        // Delete customer from table row
        function deleteCustomer(customerId) {
            if (confirm('Are you sure you want to delete this customer?')) {
                customers = customers.filter(c => c.id !== customerId);
                renderCustomers();
                if (currentCustomerId === customerId) {
                    clearForm();
                    currentCustomerId = null;
                    updateBtn.disabled = true;
                    deleteBtn.disabled = true;
                }
            }
        }

        // Search customers
        searchBtn.addEventListener('click', function() {
            const searchTerm = searchInput.value.toLowerCase();
            const type = searchType.value;

            if (searchTerm) {
                const filteredCustomers = customers.filter(customer => {
                    if (type === 'phone') return customer.phone.toLowerCase().includes(searchTerm);
                    if (type === 'id') return customer.id.toLowerCase().includes(searchTerm);
                    if (type === 'name') return customer.name.toLowerCase().includes(searchTerm);
                    return false;
                });
                renderCustomers(filteredCustomers);
            } else {
                renderCustomers();
            }
        });

        // View all customers
        viewAllBtn.addEventListener('click', function() {
            searchInput.value = '';
            renderCustomers();
        });

        // Clear form
        function clearForm() {
            customerIdInput.value = '';
            customerNameInput.value = '';
            customerPhoneInput.value = '';
        }

        // Initialize
        renderCustomers();
        updateBtn.disabled = true;
        deleteBtn.disabled = true;
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements with consistent naming
        const item_IdInput = document.getElementById('item_IdInput');
        const item_NameInput = document.getElementById('item_NameInput');
        const item_QtyInput = document.getElementById('item_QtyInput');
        const item_PriceInput = document.getElementById('item_PriceInput');
        const item_ExpireDateInput = document.getElementById('itemExpireDateInput');
        const item_AddBtn = document.getElementById('add_ItemBtn');
        const item_UpdateBtn = document.getElementById('updateItemBtn');
        const item_DeleteBtn = document.getElementById('deleteItemBtn');
        const item_ResetBtn = document.getElementById('resetFormBtn');
        const item_SearchInput = document.getElementById('itemSearchInput');
        const item_SearchBtn = document.getElementById('search_ItemBtn');
        const item_ViewAllBtn = document.getElementById('viewAllItemsBtn');
        const item_TableBody = document.getElementById('itemTableBody');

        // Item data array
        let items = [
            { id: 'I001', name: 'Cake', qty: 100, price: 120.00, expireDate: '2025-04-10' },
            { id: 'I002', name: 'Rolls', qty: 20, price: 200.00, expireDate: '2025-04-12' },
            { id: 'I003', name: 'Coffee', qty: 150, price: 500.00, expireDate: '2025-04-20' },
            { id: 'I004', name: 'Roti', qty: 50, price: 150.00, expireDate: '2025-04-15' }
        ];

        // Current item being edited
        let currentItemId = null;

        // Render item table
        function renderItems(itemsToRender = items) {
            item_TableBody.innerHTML = '';
            itemsToRender.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td>${item.qty}</td>
                <td>${item.price.toFixed(2)}</td>
                <td>${item.expireDate}</td>
                <td>
                    <button class="btn btn-sm btn-warning item_EditBtn" data-id="${item.id}">Edit</button>
                    <button class="btn btn-sm btn-danger item_DeleteRowBtn" data-id="${item.id}">Delete</button>
                </td>
            `;
                item_TableBody.appendChild(row);
            });

            // Add event listeners to edit buttons
            document.querySelectorAll('.item_EditBtn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    editItem(itemId);
                });
            });

            // Add event listeners to delete buttons
            document.querySelectorAll('.item_DeleteRowBtn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    deleteItem(itemId);
                });
            });
        }

        // Add new item
        item_AddBtn.addEventListener('click', function() {
            const newItem = {
                id: item_IdInput.value.trim(),
                name: item_NameInput.value.trim(),
                qty: parseInt(item_QtyInput.value),
                price: parseFloat(item_PriceInput.value),
                expireDate: item_ExpireDateInput.value
            };

            if (validateItem(newItem)) {
                if (items.some(item => item.id === newItem.id)) {
                    alert('Item ID already exists!');
                    return;
                }

                items.push(newItem);
                renderItems();
                clearForm();
            } else {
                alert('Please fill all fields correctly');
            }
        });

        // Update item
        item_UpdateBtn.addEventListener('click', function() {
            if (currentItemId) {
                const itemIndex = items.findIndex(i => i.id === currentItemId);
                if (itemIndex !== -1) {
                    const updatedItem = {
                        id: item_IdInput.value.trim(),
                        name: item_NameInput.value.trim(),
                        qty: parseInt(item_QtyInput.value),
                        price: parseFloat(item_PriceInput.value),
                        expireDate: item_ExpireDateInput.value
                    };

                    if (validateItem(updatedItem)) {
                        if (updatedItem.id !== currentItemId && items.some(item => item.id === updatedItem.id)) {
                            alert('Item ID already exists!');
                            return;
                        }

                        items[itemIndex] = updatedItem;
                        renderItems();
                        clearForm();
                        currentItemId = null;
                        item_UpdateBtn.disabled = true;
                        item_DeleteBtn.disabled = true;
                    }
                }
            }
        });

        // Delete item
        item_DeleteBtn.addEventListener('click', function() {
            if (currentItemId && confirm('Are you sure you want to delete this item?')) {
                items = items.filter(i => i.id !== currentItemId);
                renderItems();
                clearForm();
                currentItemId = null;
                item_UpdateBtn.disabled = true;
                item_DeleteBtn.disabled = true;
            }
        });

        // Edit item
        function editItem(itemId) {
            const item = items.find(i => i.id === itemId);
            if (item) {
                item_IdInput.value = item.id;
                item_NameInput.value = item.name;
                item_QtyInput.value = item.qty;
                item_PriceInput.value = item.price;
                item_ExpireDateInput.value = item.expireDate;
                currentItemId = item.id;
                item_UpdateBtn.disabled = false;
                item_DeleteBtn.disabled = false;
            }
        }

        // Delete item from table row
        function deleteItem(itemId) {
            if (confirm('Are you sure you want to delete this item?')) {
                items = items.filter(i => i.id !== itemId);
                renderItems();
                if (currentItemId === itemId) {
                    clearForm();
                    currentItemId = null;
                    item_UpdateBtn.disabled = true;
                    item_DeleteBtn.disabled = true;
                }
            }
        }

        // Search items
        item_SearchBtn.addEventListener('click', function() {
            const searchTerm = item_SearchInput.value.trim().toLowerCase();
            if (searchTerm) {
                const filteredItems = items.filter(item =>
                    item.id.toLowerCase().includes(searchTerm) ||
                    item.name.toLowerCase().includes(searchTerm)
                );
                renderItems(filteredItems);
            } else {
                renderItems();
            }
        });

        // View all items
        item_ViewAllBtn.addEventListener('click', function() {
            item_SearchInput.value = '';
            renderItems();
        });

        // Validate item
        function validateItem(item) {
            return item.id &&
                item.name &&
                !isNaN(item.qty) && item.qty >= 0 &&
                !isNaN(item.price) && item.price >= 0 &&
                item.expireDate;
        }

        // Reset form
        item_ResetBtn.addEventListener('click', resetForm);

        function resetForm() {
            clearForm();
            currentItemId = null;
            item_UpdateBtn.disabled = true;
            item_DeleteBtn.disabled = true;
        }

        function clearForm() {
            item_IdInput.value = '';
            item_NameInput.value = '';
            item_QtyInput.value = '';
            item_PriceInput.value = '';
            item_ExpireDateInput.value = '';
            item_IdInput.focus();
        }

        // Initialize
        renderItems();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const orderIdInput = document.getElementById('orderIdInput');
        const customerIdInput = document.getElementById('customerIdInput');
        const customerNameInput = document.getElementById('customerNameInput');
        const itemIdInput = document.getElementById('itemIdInput');
        const itemNameInput = document.getElementById('itemNameInput');
        const itemPriceInput = document.getElementById('itemPriceInput');
        const itemQtyInput = document.getElementById('itemQtyInput');
        const orderDateInput = document.getElementById('orderDateInput');
        const addItemBtn = document.getElementById('addItemBtn');
        const clearFormBtn = document.getElementById('clearFormBtn');
        const searchCustomerBtn = document.getElementById('searchCustomerBtn');
        const searchItemBtn = document.getElementById('searchItemBtn');
        const orderItemsContainer = document.getElementById('orderItemsContainer');
        const subTotalAmount = document.getElementById('subTotalAmount');
        const discountInput = document.getElementById('discountInput');
        const taxAmount = document.getElementById('taxAmount');
        const totalAmount = document.getElementById('totalAmount');
        const paymentMethodSelect = document.getElementById('paymentMethodSelect');
        const cashReceivedInput = document.getElementById('cashReceivedInput');
        const cashReceivedContainer = document.getElementById('cashReceivedContainer');
        const changeAmount = document.getElementById('changeAmount');
        const saveOrderBtn = document.getElementById('saveOrderBtn');
        const completeOrderBtn = document.getElementById('completeOrderBtn');
        const searchOrderInput = document.getElementById('searchOrderInput');
        const searchOrderBtn = document.getElementById('searchOrderBtn');
        const viewAllOrdersBtn = document.getElementById('viewAllOrdersBtn');
        const orderHistoryTable = document.getElementById('orderHistoryTable');
        const paymentSuccessModal = new bootstrap.Modal(document.getElementById('paymentSuccessModal'));
        const orderDetailsModal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
        const printReceiptBtn = document.getElementById('printReceiptBtn');
        const completedOrderId = document.getElementById('completedOrderId');
        const completedOrderAmount = document.getElementById('completedOrderAmount');
        const completedOrderChange = document.getElementById('completedOrderChange');
        const orderStatusBadge = document.getElementById('orderStatusBadge');
        const exitBtn = document.getElementById('exitBtn');

        // Sample data
        const customers = [
            { id: 'C001', name: 'Shamindu' },
            { id: 'C002', name: 'Kasun' },
            { id: 'C003', name: 'Rani' }
        ];

        const items = [
            { id: 'I001', name: 'Cake', price: 1200.00 },
            { id: 'I002', name: 'Rolls', price: 25.00 },
            { id: 'I003', name: 'Coffee', price: 45.00 },
            { id: 'I004', name: 'Roti', price: 250.00 }
        ];

        let orders = [
            {
                id: 'ORD-1001',
                customerId: 'C001',
                customerName: 'Shamindu',
                date: '2024-04-15',
                items: [
                    { id: 'I001', name: 'Cake', price: 1200.00, qty: 1 },
                    { id: 'I002', name: 'Rolls', price: 25.00, qty: 2 }
                ],
                subTotal: 1250.00,
                discount: 0,
                tax: 125.00,
                total: 1375.00,
                paymentMethod: 'Cash',
                cashReceived: 1500.00,
                change: 125.00,
                status: 'Completed',
                paymentStatus: 'Paid'
            },
            {
                id: 'ORD-1002',
                customerId: 'C002',
                customerName: 'Kasun',
                date: '2024-04-16',
                items: [
                    { id: 'I003', name: 'Coffee', price: 45.00, qty: 3 },
                    { id: 'I004', name: 'Roti', price: 250.00, qty: 1 }
                ],
                subTotal: 385.00,
                discount: 10,
                tax: 38.50,
                total: 423.50,
                paymentMethod: 'Card',
                cashReceived: 0.00,
                change: 0.00,
                status: 'Pending',
                paymentStatus: 'Unpaid'
            }
        ];

        // Current order
        let currentOrder = {
            id: generateOrderId(),
            customerId: '',
            customerName: '',
            date: new Date().toISOString().split('T')[0],
            items: [],
            subTotal: 0,
            discount: 0,
            tax: 0,
            total: 0,
            paymentMethod: 'Cash',
            cashReceived: 0,
            change: 0,
            status: 'New',
            paymentStatus: 'Unpaid'
        };

        // Initialize
        orderIdInput.value = currentOrder.id;
        orderDateInput.value = currentOrder.date;
        renderOrderHistory();
        updateOrderSummary();

        // Event Listeners
        addItemBtn.addEventListener('click', addItemToOrder);
        clearFormBtn.addEventListener('click', clearForm);
        searchCustomerBtn.addEventListener('click', searchCustomer);
        searchItemBtn.addEventListener('click', searchItem);
        discountInput.addEventListener('input', updateOrderSummary);
        paymentMethodSelect.addEventListener('change', updatePaymentMethod);
        cashReceivedInput.addEventListener('input', updateOrderSummary);
        saveOrderBtn.addEventListener('click', saveOrder);
        completeOrderBtn.addEventListener('click', completeOrder);
        searchOrderBtn.addEventListener('click', searchOrders);
        viewAllOrdersBtn.addEventListener('click', renderOrderHistory);
        printReceiptBtn.addEventListener('click', printReceipt);
        exitBtn.addEventListener('click', exitOrderManagement);

        // Customer ID input event
        customerIdInput.addEventListener('change', function() {
            const customer = customers.find(c => c.id === customerIdInput.value);
            if (customer) {
                customerNameInput.value = customer.name;
                currentOrder.customerId = customer.id;
                currentOrder.customerName = customer.name;
            } else {
                customerNameInput.value = '';
                currentOrder.customerId = '';
                currentOrder.customerName = '';
            }
        });

        // Item ID input event
        itemIdInput.addEventListener('change', function() {
            const item = items.find(i => i.id === itemIdInput.value);
            if (item) {
                itemNameInput.value = item.name;
                itemPriceInput.value = item.price.toFixed(2);
            } else {
                itemNameInput.value = '';
                itemPriceInput.value = '';
            }
        });

        // Functions
        function generateOrderId() {
            return 'ORD-' + (1000 + orders.length + 1);
        }

        function updatePaymentMethod() {
            currentOrder.paymentMethod = paymentMethodSelect.value;
            if (currentOrder.paymentMethod === 'Cash') {
                cashReceivedContainer.style.display = 'block';
            } else {
                cashReceivedContainer.style.display = 'none';
                cashReceivedInput.value = '0';
                currentOrder.cashReceived = 0;
                updateOrderSummary();
            }
        }

        function addItemToOrder() {
            const itemId = itemIdInput.value;
            const itemName = itemNameInput.value;
            const price = parseFloat(itemPriceInput.value);
            const qty = parseInt(itemQtyInput.value);

            if (!itemId || !itemName || isNaN(price) || isNaN(qty)) {
                alert('Please select a valid item and quantity');
                return;
            }

            // Check if item already exists in order
            const existingItemIndex = currentOrder.items.findIndex(item => item.id === itemId);
            if (existingItemIndex >= 0) {
                // Update quantity if item already exists
                currentOrder.items[existingItemIndex].qty += qty;
            } else {
                // Add new item
                currentOrder.items.push({
                    id: itemId,
                    name: itemName,
                    price: price,
                    qty: qty
                });
            }

            // Update order status
            currentOrder.status = 'In Progress';
            orderStatusBadge.textContent = currentOrder.status;
            orderStatusBadge.className = 'badge bg-warning';

            renderOrderItems();
            updateOrderSummary();
            clearItemForm();
        }

        function renderOrderItems() {
            if (currentOrder.items.length === 0) {
                orderItemsContainer.innerHTML = '<p class="text-muted text-center">No items added to order</p>';
                return;
            }

            let html = '';
            currentOrder.items.forEach((item, index) => {
                html += `
                <div class="order-item d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">${item.name}</h6>
                        <small class="text-muted">${item.id} | Rs. ${item.price.toFixed(2)} x ${item.qty}</small>
                    </div>
                    <div>
                        <span class="fw-bold">Rs. ${(item.price * item.qty).toFixed(2)}</span>
                        <button class="btn btn-sm btn-outline-danger ms-2 remove-item-btn" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-primary ms-1 edit-item-btn" data-index="${index}">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
            `;
            });

            orderItemsContainer.innerHTML = html;

            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    currentOrder.items.splice(index, 1);
                    renderOrderItems();
                    updateOrderSummary();

                    if (currentOrder.items.length === 0) {
                        currentOrder.status = 'New';
                        orderStatusBadge.textContent = currentOrder.status;
                        orderStatusBadge.className = 'badge bg-primary';
                    }
                });
            });

            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-item-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const item = currentOrder.items[index];

                    itemIdInput.value = item.id;
                    itemNameInput.value = item.name;
                    itemPriceInput.value = item.price.toFixed(2);
                    itemQtyInput.value = item.qty;

                    // Remove the item from order (will be re-added when user clicks Add Item)
                    currentOrder.items.splice(index, 1);
                    renderOrderItems();
                    updateOrderSummary();
                });
            });
        }

        function updateOrderSummary() {
            // Calculate subtotal
            currentOrder.subTotal = currentOrder.items.reduce((sum, item) => sum + (item.price * item.qty), 0);

            // Get discount
            currentOrder.discount = parseFloat(discountInput.value) || 0;

            // Calculate tax (10%)
            currentOrder.tax = (currentOrder.subTotal * 0.1);

            // Calculate total
            const discountAmount = currentOrder.subTotal * (currentOrder.discount / 100);
            currentOrder.total = (currentOrder.subTotal - discountAmount) + currentOrder.tax;

            // Get cash received
            currentOrder.cashReceived = parseFloat(cashReceivedInput.value) || 0;

            // Calculate change
            currentOrder.change = currentOrder.cashReceived - currentOrder.total;

            // Update UI
            subTotalAmount.textContent = currentOrder.subTotal.toFixed(2);
            taxAmount.textContent = currentOrder.tax.toFixed(2);
            totalAmount.textContent = currentOrder.total.toFixed(2);
            changeAmount.textContent = currentOrder.change.toFixed(2);

            // Enable/disable complete order button based on payment
            if (currentOrder.paymentMethod === 'Cash') {
                completeOrderBtn.disabled = currentOrder.cashReceived < currentOrder.total;
            } else {
                completeOrderBtn.disabled = false;
            }

            // Highlight change if negative
            if (currentOrder.change < 0) {
                changeAmount.classList.add('text-danger');
            } else {
                changeAmount.classList.remove('text-danger');
            }
        }

        function clearForm() {
            customerIdInput.value = '';
            customerNameInput.value = '';
            clearItemForm();
            currentOrder.customerId = '';
            currentOrder.customerName = '';
        }

        function clearItemForm() {
            itemIdInput.value = '';
            itemNameInput.value = '';
            itemPriceInput.value = '';
            itemQtyInput.value = '1';
            itemIdInput.focus();
        }

        function searchCustomer() {
            const customerId = customerIdInput.value.trim();
            if (!customerId) {
                alert('Please enter a customer ID');
                return;
            }

            const customer = customers.find(c => c.id === customerId);
            if (customer) {
                customerNameInput.value = customer.name;
                currentOrder.customerId = customer.id;
                currentOrder.customerName = customer.name;
            } else {
                alert('Customer not found');
                customerNameInput.value = '';
                currentOrder.customerId = '';
                currentOrder.customerName = '';
            }
        }

        function searchItem() {
            const itemId = itemIdInput.value.trim();
            if (!itemId) {
                alert('Please enter an item ID');
                return;
            }

            const item = items.find(i => i.id === itemId);
            if (item) {
                itemNameInput.value = item.name;
                itemPriceInput.value = item.price.toFixed(2);
            } else {
                alert('Item not found');
                itemNameInput.value = '';
                itemPriceInput.value = '';
            }
        }

        function saveOrder() {
            if (currentOrder.items.length === 0) {
                alert('Please add items to the order');
                return;
            }

            // Update payment method
            currentOrder.paymentMethod = paymentMethodSelect.value;

            // Set payment status based on payment method and amount received
            if (currentOrder.paymentMethod === 'Cash') {
                if (currentOrder.cashReceived >= currentOrder.total) {
                    currentOrder.paymentStatus = 'Paid';
                } else if (currentOrder.cashReceived > 0) {
                    currentOrder.paymentStatus = 'Partially Paid';
                } else {
                    currentOrder.paymentStatus = 'Unpaid';
                }
            } else {
                currentOrder.paymentStatus = 'Paid';
                currentOrder.cashReceived = currentOrder.total;
                currentOrder.change = 0;
            }

            // Update order status
            currentOrder.status = currentOrder.paymentStatus === 'Paid' ? 'Completed' : 'Pending';
            orderStatusBadge.textContent = currentOrder.status;
            orderStatusBadge.className = currentOrder.status === 'Completed' ? 'badge bg-success' : 'badge bg-warning';

            // Add to orders history
            orders.unshift({...currentOrder});

            // Show success message
            alert(`Order ${currentOrder.id} saved successfully with status: ${currentOrder.status}`);

            // Reset for new order
            resetForNewOrder();
        }

        function completeOrder() {
            if (currentOrder.items.length === 0) {
                alert('Please add items to the order');
                return;
            }

            if (currentOrder.paymentMethod === 'Cash' && currentOrder.cashReceived < currentOrder.total) {
                alert('Cash received is less than total amount');
                return;
            }

            // Update payment method
            currentOrder.paymentMethod = paymentMethodSelect.value;

            // Set payment status
            currentOrder.paymentStatus = 'Paid';
            if (currentOrder.paymentMethod !== 'Cash') {
                currentOrder.cashReceived = currentOrder.total;
                currentOrder.change = 0;
            }

            // Update order status
            currentOrder.status = 'Completed';
            orderStatusBadge.textContent = currentOrder.status;
            orderStatusBadge.className = 'badge bg-success';

            // Add to orders history
            orders.unshift({...currentOrder});

            // Show success modal
            completedOrderId.textContent = currentOrder.id;
            completedOrderAmount.textContent = 'Rs. ' + currentOrder.total.toFixed(2);
            completedOrderChange.textContent = 'Rs. ' + currentOrder.change.toFixed(2);
            paymentSuccessModal.show();

            // Reset for new order
            resetForNewOrder();
        }

        function resetForNewOrder() {
            currentOrder = {
                id: generateOrderId(),
                customerId: '',
                customerName: '',
                date: new Date().toISOString().split('T')[0],
                items: [],
                subTotal: 0,
                discount: 0,
                tax: 0,
                total: 0,
                paymentMethod: 'Cash',
                cashReceived: 0,
                change: 0,
                status: 'New',
                paymentStatus: 'Unpaid'
            };

            orderIdInput.value = currentOrder.id;
            orderDateInput.value = currentOrder.date;
            paymentMethodSelect.value = 'Cash';
            cashReceivedContainer.style.display = 'block';
            orderStatusBadge.textContent = currentOrder.status;
            orderStatusBadge.className = 'badge bg-primary';
            clearForm();
            renderOrderItems();
            updateOrderSummary();
            renderOrderHistory();
        }

        function renderOrderHistory(filteredOrders = orders) {
            orderHistoryTable.innerHTML = '';

            if (filteredOrders.length === 0) {
                orderHistoryTable.innerHTML = `
                <tr>
                    <td colspan="8" class="text-center text-muted py-4">No orders found</td>
                </tr>
            `;
                return;
            }

            filteredOrders.forEach(order => {
                const row = document.createElement('tr');
                row.className = 'cursor-pointer';

                // Determine status badge color
                let statusBadgeClass = '';
                if (order.status === 'Completed') {
                    statusBadgeClass = 'bg-success';
                } else if (order.status === 'Pending') {
                    statusBadgeClass = 'bg-warning';
                } else {
                    statusBadgeClass = 'bg-primary';
                }

                // Determine payment status badge color
                let paymentBadgeClass = '';
                if (order.paymentStatus === 'Paid') {
                    paymentBadgeClass = 'bg-success';
                } else if (order.paymentStatus === 'Partially Paid') {
                    paymentBadgeClass = 'bg-warning';
                } else {
                    paymentBadgeClass = 'bg-danger';
                }

                row.innerHTML = `
                <td>${order.id}</td>
                <td>${order.customerName}</td>
                <td>${order.items.length} items</td>
                <td>Rs. ${order.total.toFixed(2)}</td>
                <td>${order.date}</td>
                <td>
                    <span class="badge ${statusBadgeClass}">
                        ${order.status}
                    </span>
                </td>
                <td>
                    <span class="badge ${paymentBadgeClass}">
                        ${order.paymentStatus}
                    </span>
                </td>
                <td class="text-end">
                    <button class="btn btn-sm btn-outline-primary edit-order-btn me-1" data-orderid="${order.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger delete-order-btn" data-orderid="${order.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;

                // Add click event to view order details
                row.addEventListener('click', () => viewOrderDetails(order.id));

                // Add event listeners to edit and delete buttons
                const editBtn = row.querySelector('.edit-order-btn');
                const deleteBtn = row.querySelector('.delete-order-btn');

                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    editOrder(order.id);
                });

                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteOrder(order.id);
                });

                orderHistoryTable.appendChild(row);
            });
        }

        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            // Update modal elements
            document.getElementById('modalOrderId').textContent = order.id;
            document.getElementById('modalCustomerName').textContent = order.customerName;
            document.getElementById('modalOrderDate').textContent = order.date;

            // Status badges
            const statusBadge = document.getElementById('modalOrderStatus');
            statusBadge.textContent = order.status;
            statusBadge.className = 'badge ' + (order.status === 'Completed' ? 'bg-success' : 'bg-warning');

            const paymentBadge = document.getElementById('modalPaymentStatus');
            paymentBadge.textContent = order.paymentStatus;
            paymentBadge.className = 'badge ' +
                (order.paymentStatus === 'Paid' ? 'bg-success' :
                    order.paymentStatus === 'Partially Paid' ? 'bg-warning' : 'bg-danger');

            // Order items
            const itemsTable = document.getElementById('modalOrderItems');
            itemsTable.innerHTML = '';
            order.items.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${item.id}</td>
                <td>${item.name}</td>
                <td>Rs. ${item.price.toFixed(2)}</td>
                <td>${item.qty}</td>
                <td>Rs. ${(item.price * item.qty).toFixed(2)}</td>
            `;
                itemsTable.appendChild(row);
            });

            // Order totals
            document.getElementById('modalSubTotal').textContent = 'Rs. ' + order.subTotal.toFixed(2);
            document.getElementById('modalDiscount').textContent = order.discount + '%';
            document.getElementById('modalTax').textContent = 'Rs. ' + order.tax.toFixed(2);
            document.getElementById('modalTotal').textContent = 'Rs. ' + order.total.toFixed(2);

            // Payment information
            document.getElementById('modalPaymentMethod').textContent = order.paymentMethod;
            document.getElementById('modalCashReceived').textContent = 'Rs. ' + order.cashReceived.toFixed(2);
            document.getElementById('modalChange').textContent = 'Rs. ' + order.change.toFixed(2);

            // Show/hide payment section based on payment status
            const paymentSection = document.getElementById('paymentSection');
            if (order.paymentStatus === 'Paid') {
                paymentSection.style.display = 'block';
            } else {
                paymentSection.style.display = 'none';
            }

            // Show modal
            orderDetailsModal.show();
        }

        function editOrder(orderId) {
            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            const order = orders[orderIndex];

            // Set current order to the selected order
            currentOrder = {...order};

            // Update UI with order details
            orderIdInput.value = currentOrder.id;
            orderDateInput.value = currentOrder.date;
            customerIdInput.value = currentOrder.customerId;
            customerNameInput.value = currentOrder.customerName;
            discountInput.value = currentOrder.discount;
            paymentMethodSelect.value = currentOrder.paymentMethod;
            cashReceivedInput.value = currentOrder.cashReceived;
            updatePaymentMethod();

            // Update status badge
            orderStatusBadge.textContent = currentOrder.status;
            if (currentOrder.status === 'Completed') {
                orderStatusBadge.className = 'badge bg-success';
            } else if (currentOrder.status === 'Pending') {
                orderStatusBadge.className = 'badge bg-warning';
            } else {
                orderStatusBadge.className = 'badge bg-primary';
            }

            // Render items
            renderOrderItems();
            updateOrderSummary();

            // Remove the order from the orders array (will be re-added when completed)
            orders.splice(orderIndex, 1);

            // Scroll to top
            window.scrollTo(0, 0);
        }

        function deleteOrder(orderId) {
            if (!confirm('Are you sure you want to delete this order?')) {
                return;
            }

            const orderIndex = orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;

            orders.splice(orderIndex, 1);
            renderOrderHistory();

            alert('Order deleted successfully');
        }

        function searchOrders() {
            const searchTerm = searchOrderInput.value.trim().toLowerCase();
            if (!searchTerm) {
                renderOrderHistory();
                return;
            }

            const filteredOrders = orders.filter(order =>
                order.id.toLowerCase().includes(searchTerm) ||
                order.customerName.toLowerCase().includes(searchTerm) ||
                order.status.toLowerCase().includes(searchTerm) ||
                order.paymentStatus.toLowerCase().includes(searchTerm)
            );
            renderOrderHistory(filteredOrders);
        }

        function printReceipt() {
            const orderId = completedOrderId.textContent;
            const order = orders.find(o => o.id === orderId);

            if (order) {
                let receiptContent = `
                <h2 class="text-center">Receipt</h2>
                <hr>
                <p><strong>Order ID:</strong> ${order.id}</p>
                <p><strong>Customer:</strong> ${order.customerName}</p>
                <p><strong>Date:</strong> ${order.date}</p>
                <p><strong>Payment Method:</strong> ${order.paymentMethod}</p>
                <hr>
                <h4>Items:</h4>
                <ul>
            `;

                order.items.forEach(item => {
                    receiptContent += `
                    <li>${item.name} - ${item.qty} x Rs. ${item.price.toFixed(2)} = Rs. ${(item.qty * item.price).toFixed(2)}</li>
                `;
                });

                receiptContent += `
                </ul>
                <hr>
                <p><strong>Subtotal:</strong> Rs. ${order.subTotal.toFixed(2)}</p>
                <p><strong>Discount:</strong> ${order.discount}%</p>
                <p><strong>Tax (10%):</strong> Rs. ${order.tax.toFixed(2)}</p>
                <h4><strong>Total:</strong> Rs. ${order.total.toFixed(2)}</h4>
            `;

                if (order.paymentMethod === 'Cash') {
                    receiptContent += `
                    <hr>
                    <p><strong>Cash Received:</strong> Rs. ${order.cashReceived.toFixed(2)}</p>
                    <p><strong>Change:</strong> Rs. ${order.change.toFixed(2)}</p>
                `;
                }

                receiptContent += `
                <hr>
                <p class="text-center">Thank you for your business!</p>
            `;

                // Open print window
                const printWindow = window.open('', '', 'width=600,height=600');
                printWindow.document.write(`
                <html>
                    <head>
                        <title>Receipt for Order ${order.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h2, h4 { color: #333; }
                            hr { border: 0; border-top: 1px solid #eee; margin: 10px 0; }
                            ul { list-style-type: none; padding: 0; }
                            li { margin-bottom: 5px; }
                            .text-center { text-align: center; }
                        </style>
                    </head>
                    <body>
                        ${receiptContent}
                        <script>
                            window.onload = function() {
                                setTimeout(function() {
                                    window.print();
                                    window.close();
                                }, 200);
                            };

</body>
</html>
`);
printWindow.document.close();
}

paymentSuccessModal.hide();
}

function exitOrderManagement() {
if (currentOrder.items.length > 0 && !confirm('You have items in your current order. Are you sure you want to exit?')) {
return;
}

// In a real application, you would navigate to the home section
alert('Exiting order management system');
// showSection('home'); // Uncomment if you have this function
}
});
</script>

</body>
</html>